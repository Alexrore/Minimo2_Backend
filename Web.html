<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Void-Gate</title>
    <!-- BOOTSTRAP 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background: #ffffff;
            color: #000000;
        }
        .card {
            background: #f2f4f8;
            border-radius: 12px;
            border: 1px solid #d0d4dd;
            color: #000000;
        }
        input, input::placeholder {
            color: #000000 !important;
        }
        input {
            background: #ffffff !important;
            border: 1px solid #b8bfd0 !important;
            color: #000000 !important;
        }
        #headerTitle {
            background: none;
            padding: 0;
            border-radius: 0;
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            color: #0d6efd;
        }

        /* üî• verificaci√≥n ahora SIEMPRE visible */
        .codigo-input {
            font-size: 24px;
            text-align: center;
            letter-spacing: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body class="container py-5">
    <div id="headerTitle">VOID-GATE</div>
    <h2 class="text-center my-4">Usuarios & Tienda</h2>
    
    <!-- REGISTRO Y LOGIN -->
    <div id="authSection" class="row g-4">
        <!-- REGISTRO -->
        <div class="col-md-6">
            <div class="card p-3">
                <h4><i class="bi bi-person-plus"></i> Registro</h4>
                <input id="regNombre" type="text" class="form-control mb-2" placeholder="Nombre">
                <input id="regEmail" type="email" class="form-control mb-2" placeholder="Email">
                <input id="regPassword" type="password" class="form-control mb-3" placeholder="Contrase√±a">
                <button id="btnRegistrar" class="btn btn-primary w-100">Registrar</button>
                <p id="msgRegistro" class="mt-2 text-center"></p>
            </div>
        </div>

        <!-- LOGIN -->
        <div class="col-md-6">
            <div class="card p-3">
                <h4><i class="bi bi-box-arrow-in-right"></i> Login</h4>
                <input id="loginEmail" type="email" class="form-control mb-2" placeholder="Email">
                <input id="loginPassword" type="password" class="form-control mb-3" placeholder="Contrase√±a">
                <button id="btnLogin" class="btn btn-success w-100">Iniciar sesi√≥n</button>
                <p id="msgLogin" class="mt-2 text-center"></p>
            </div>
        </div>
    </div>

    <!-- üî• SECCI√ìN DE VERIFICACI√ìN SIEMPRE VISIBLE Y CENTRADA -->
    <div class="row g-4 mt-4">
        <div class="col-md-6 mx-auto">
            <div class="card p-4 text-center">
                <h4><i class="bi bi-shield-check"></i> Verificaci√≥n de Email</h4>
                <p class="text-muted">Introduce tu email y el c√≥digo de verificaci√≥n.</p>

                <input id="verifEmail" type="email" class="form-control mb-3" placeholder="Email">
                <input id="verifCodigo" 
                       type="text" 
                       class="form-control codigo-input mb-3" 
                       placeholder="000000" 
                       maxlength="6"
                       pattern="[0-9]*">
                
                <button id="btnVerificar" class="btn btn-success w-100 mb-2">
                    <i class="bi bi-check-circle"></i> Verificar c√≥digo
                </button>
                
                <button id="btnReenviarCodigo" class="btn btn-outline-secondary w-100">
                    <i class="bi bi-arrow-clockwise"></i> Reenviar c√≥digo
                </button>
                
                <p id="msgVerificacion" class="mt-3"></p>
            </div>
        </div>
    </div>

    <!-- PRODUCTOS -->
    <div id="productosSection" class="row g-4 mt-4" style="display:none;">
        <div class="col-md-12">
            <div class="card p-3">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="bi bi-shop"></i> Productos</h4>
                    <button id="btnCerrarSesion" class="btn btn-outline-danger btn-sm">
                        <i class="bi bi-box-arrow-right"></i> Cerrar sesi√≥n
                    </button>
                </div>
                <button id="btnListarProductos" class="btn btn-info w-100 mb-3">Cargar productos</button>
                <ul id="listaProductos" class="list-group mb-3"></ul>
                <hr>
                <h5>A√±adir producto</h5>
                <input id="prodNombre" type="text" class="form-control mb-2" placeholder="Nombre del producto">
                <input id="prodPrecio" type="number" class="form-control mb-3" placeholder="Precio">
                <button id="btnAnadirProducto" class="btn btn-warning w-100">A√±adir</button>
                <p id="msgProducto" class="mt-2 text-center"></p>
                <hr>
                <h5>Buscar producto</h5>
                <input id="buscarNombre" type="text" class="form-control mb-3" placeholder="Nombre del producto">
                <button id="btnBuscarProducto" class="btn btn-secondary w-100">Buscar</button>
                <p id="msgBuscarProducto" class="mt-2 text-center"></p>
            </div>
        </div>
    </div>

<script>
const URL_USU = "http://localhost:8080/dsaApp/usuarios";
const URL_PROD = "http://localhost:8080/dsaApp/productos";

// üî• REGISTRO
$("#btnRegistrar").click(function () {
    const data = {
        nombre: $("#regNombre").val(),
        email: $("#regEmail").val(),
        password: $("#regPassword").val()
    };
    
    $.ajax({
        url: URL_USU + "/register",
        type: "POST",
        data: JSON.stringify(data),
        contentType: "application/json",
        success: function () {
            $("#msgRegistro").html(`<span class='text-success'>Usuario registrado ‚úîÔ∏è</span>`);
        },
        error: function (xhr) {
            $("#msgRegistro").html(`<span class='text-danger'>${xhr.responseText}</span>`);
        }
    });
});

// üî• VERIFICACI√ìN
$("#btnVerificar").click(function () {
    const email = $("#verifEmail").val().trim();
    const codigo = $("#verifCodigo").val().trim();

    if (!email || codigo.length !== 6) {
        $("#msgVerificacion").html(`<span class='text-danger'>Completa email y c√≥digo v√°lido</span>`);
        return;
    }
    
    $.ajax({
        url: URL_USU + "/verificar-codigo",
        type: "POST",
        data: JSON.stringify({ email: email, codigo: codigo }),
        contentType: "application/json",
        success: function (res) {
            $("#msgVerificacion").html(`<span class='text-success'>Verificado correctamente ‚úîÔ∏è</span>`);
        },
        error: function (xhr) {
            $("#msgVerificacion").html(`<span class='text-danger'>${xhr.responseText}</span>`);
        }
    });
});
// üî• REENVIAR C√ìDIGO
$("#btnReenviarCodigo").click(function () {
    const email = $("#verifEmail").val().trim();

    $.ajax({
        url: URL_USU + "/reenviar-codigo",
        type: "POST",
        data: JSON.stringify({ email }),
        contentType: "application/json",
        success: function (res) {
            $("#msgVerificacion").html(`<span class='text-info'>${res}</span>`);
        },
        error: function (xhr) {
            $("#msgVerificacion").html(`<span class='text-danger'>${xhr.responseText}</span>`);
        }
    });
});

// LOGIN
$("#btnLogin").click(function () {
    const data = {
        email: $("#loginEmail").val(),
        password: $("#loginPassword").val()
    };
    
    $.ajax({
        url: URL_USU + "/login",
        type: "POST",
        data: JSON.stringify(data),
        contentType: "application/json",
        success: function (res) {
            $("#msgLogin").html(`<span class='text-success'>Bienvenido ${res.nombre} ‚úîÔ∏è</span>`);
            $("#authSection").fadeOut(function() {
                $("#productosSection").fadeIn();
            });
        },
        error: function (xhr) {
            $("#msgLogin").html(`<span class='text-danger'>${xhr.responseText}</span>`);
        }
    });
});

// CERRAR SESI√ìN
$("#btnCerrarSesion").click(function() {
    $("#productosSection").fadeOut(function() {
        $("#authSection").fadeIn();
    });

    $("#loginEmail").val("");
    $("#loginPassword").val("");
});

// PRODUCTOS
$("#btnListarProductos").click(function () {
    $.get(URL_PROD + "/", function (data) {
        $("#listaProductos").empty();
        data.forEach(p => {
            $("#listaProductos").append(`
                <li class="list-group-item d-flex justify-content-between">
                    <b>${p.nombreproducto}</b>
                    <span>${p.precio}‚Ç¨</span>
                </li>`);
        });
    }).fail(function (xhr) {
        alert("Error: " + xhr.responseText);
    });
});

$("#btnAnadirProducto").click(function () {
    const data = {
        nombreproducto: $("#prodNombre").val(),
        precio: parseFloat($("#prodPrecio").val())
    };
    
    $.ajax({
        url: URL_PROD + "/",
        type: "POST",
        data: JSON.stringify(data),
        contentType: "application/json",
        success: function () {
            $("#msgProducto").html(`<span class='text-success'>Producto creado ‚úîÔ∏è</span>`);
            $("#prodNombre").val("");
            $("#prodPrecio").val("");
        },
        error: function (xhr) {
            $("#msgProducto").html(`<span class='text-danger'>${xhr.responseText}</span>`);
        }
    });
});

$("#btnBuscarProducto").click(function () {
    const nombre = $("#buscarNombre").val().trim();
    if (!nombre) {
        $("#msgBuscarProducto").html(`<span class='text-danger'>Introduce un nombre</span>`);
        return;
    }
    
    $.ajax({
        url: URL_PROD + "/" + nombre,
        type: "GET",
        success: function (p) {
            $("#msgBuscarProducto").html(`
                <span class='text-success'>
                    Producto encontrado ‚úîÔ∏è<br>
                    <b>${p.nombreproducto}</b> ‚Äî ${p.precio}‚Ç¨
                </span>`);
        },
        error: function (xhr) {
            $("#msgBuscarProducto").html(`<span class='text-danger'>${xhr.responseText}</span>`);
        }
    });
});

// Solo n√∫meros en c√≥digo
$("#verifCodigo").on('input', function() {
    this.value = this.value.replace(/[^0-9]/g, '');
});
</script>
</body>
</html>

